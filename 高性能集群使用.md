# 高性能集群使用

## 一、使用MobaXterm与服务器建立连接

跳板机IP：172.16.108.134

超算集群IP：192.168.10.15

### 1.下载MobaXterm

https://mobaxterm.mobatek.net/download-home-edition.html

### 2.进入界面，选择Session

![屏幕截图 2024-09-17 161550](C:\Users\47687\Desktop\截图\处理\屏幕截图 2024-09-17 161550.png)

### 3.在Session设置窗口中选择SSH连接，然后在”Advanced SSH settings”选项卡中的”SSH-browser type”切换为SCP

![屏幕截图 2024-09-17 161616](C:\Users\47687\Desktop\截图\处理\屏幕截图 2024-09-17 161616.png)

### 4.切换到”Advanced SSH settings”选项卡，进入SSH gateway设置

![屏幕截图 2024-09-17 161706](C:\Users\47687\Desktop\截图\处理\屏幕截图 2024-09-17 161706.png)

### 5.输入跳板机的IP地址，自己的跳板机用户名，点击OK

![屏幕截图 2024-09-17 161750](C:\Users\47687\Desktop\截图\屏幕截图 2024-09-17 161750.png)

### 6.继续在Session设置窗口中输入服务器IP和自己的服务器用户名，点击OK

![屏幕截图 2024-09-17 161839](C:\Users\47687\Desktop\截图\处理\屏幕截图 2024-09-17 161839.png)

### 7.在弹出窗口中输入跳板机的密码，点击OK

![屏幕截图 2024-09-17 161921](C:\Users\47687\Desktop\截图\屏幕截图 2024-09-17 161921.png)

### 8.在MobaXterm的浏览器界面中输入服务器的密码，回车登录

![屏幕截图 2024-09-17 162004](C:\Users\47687\Desktop\截图\屏幕截图 2024-09-17 162004.png)

### 9.登录成功界面

![屏幕截图 2024-09-17 162256](C:\Users\47687\Desktop\截图\屏幕截图 2024-09-17 162256.png)

## 二、使用服务器计算资源

### 1.使用module avi查看可用软件，使用module load来装载需要的软件环境

![屏幕截图 2024-09-17 170008](C:\Users\47687\Desktop\截图\屏幕截图 2024-09-17 170008.png)

### 2.执行以下两个指令可以使服务器能够联网，便于下载软件包等

```bash
export http_proxy=http://192.168.10.22:3128
export https_proxy=http://192.168.10.22:3128
```

![屏幕截图 2024-09-17 172809](C:\Users\47687\Desktop\截图\屏幕截图 2024-09-17 172809.png)

![屏幕截图 2024-09-17 172836](C:\Users\47687\Desktop\截图\屏幕截图 2024-09-17 172836.png)

### 3.使用sinfo命令查看计算资源可用情况

![屏幕截图 2024-09-17 175311](C:\Users\47687\Desktop\截图\屏幕截图 2024-09-17 175311.png)

### 4.编写任务提交的脚本，新建.sh文件，输入如下内容：

```python
#!/bin/bash  # 固定内容，不用修改 
#SBATCH -p x86_64  # 向调度系统申请 x86_64队列的计算资源
#SBATCH -n 1  # 申请1个核 
#SBATCH -G 0  # 申请0块GPU卡 
#SBATCH -o job1.out  # 程序的运行输出保存在 job1.out 文件，文件名随意修改 

python hello.py  # 程序自身的运行命令
```

![屏幕截图 2024-09-17 175358](C:\Users\47687\Desktop\截图\屏幕截图 2024-09-17 175358.png)

### 5.执行sbatch run1.sh提交计算任务，会返回一个任务ID，可使用squeue -u [用户名]查看任务状态和使用tail -f job1.out查看输出结果

![屏幕截图 2024-09-17 175614](C:\Users\47687\Desktop\截图\屏幕截图 2024-09-17 175614.png)

## 三、使用VScode与服务器建立连接

### 1.在扩展商店中搜索安装Remote - SSH

![屏幕截图 2024-09-17 190639](C:\Users\47687\Desktop\截图\屏幕截图 2024-09-17 190639.png)

### 2.点击左侧选项卡新增的远程资源管理器，再点击设置按钮打开SSH配置文件

![屏幕截图 2024-09-17 190729](C:\Users\47687\Desktop\截图\处理\屏幕截图 2024-09-17 190729.png)

### 3.点击打开SSH配置文件按钮后，会在主界面上边弹出待选栏，点击选择第一个

![屏幕截图 2024-09-17 190857](C:\Users\47687\Desktop\截图\屏幕截图 2024-09-17 190857.png)

### 4.选择后进自动跳转至配置文件编辑窗口，按照下面的图例编辑SSH配置文件。

两个Host之后分别是你给跳板机和服务器取的名字

两个HostName之后分别是跳板机和服务器的IP地址

两个User之后分别是你在跳板机和服务器上的用户名

ProxyCommand ssh -w %h:%p [跳板机]最后需要修改为你给跳板机取的名字

最后保存该配置文件

![屏幕截图 2024-09-17 190934](C:\Users\47687\Desktop\截图\屏幕截图 2024-09-17 190934.png)

### 5.左侧活动栏中点击刷新，会提示输入跳板机和服务器的密码，输入后即可连接到服务器

![屏幕截图 2024-09-17 191102](C:\Users\47687\Desktop\截图\处理\屏幕截图 2024-09-17 191102.png)

### 6.在左侧选项卡的资源管理器中可以在服务器上便捷地操作文件，编辑代码

![屏幕截图 2024-09-17 191442](C:\Users\47687\Desktop\截图\处理\屏幕截图 2024-09-17 191442.png)

## 四、免密登录设置

### 1.在自己的电脑上的cmd中执行ssh-keygen -t rsa -C cc，之后会需要选择生成路径，输入密码和再次输入密码，全部回车跳过即可，都不需要输入，最后会在默认路径上生成公钥和私钥

![屏幕截图 2024-09-17 193606](C:\Users\47687\Desktop\截图\处理\屏幕截图 2024-09-17 193606.png)

### 2.在自己电脑上的默认路径C:\Users\[你的用户名]\.ssh中找到存储公钥的文件id_rsa.pub，以记事本方式打开

![屏幕截图 2024-09-17 193701](C:\Users\47687\Desktop\截图\屏幕截图 2024-09-17 193701.png)

### 3.在vscode的资源管理器中进入用户根目录中的.ssh文件夹，找到authorized_keys文件，双击打开，然后将上面id_rsa.pub的内容新起一行粘贴到该文件中

若没有authorized_keys，新建一个：

```bash
mkdir ~/.ssh  #创建.ssh文件夹
touch ~/.ssh/authorized_keys  #创建储存公钥的文件
```

*跳板机和服务器上的用户根目录下都有.ssh文件夹，需要同样的操作进行两次，最后保存文件即可

![屏幕截图 2024-09-17 193921](C:\Users\47687\Desktop\截图\屏幕截图 2024-09-17 193921.png)

